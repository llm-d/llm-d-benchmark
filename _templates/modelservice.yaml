fullnameOverride: .standup[0].parameters.model[0].label
multinode: False
modelArtifacts:
  uri: .standup[0].parameters.volumes[0].type://.standup[0].parameters.volumes[0].mount/models/.standup[0].parameters.model[0].name
  size: .prepare.dependencies.storage[]|select(name=.standup[0].stack.parameters.volumes[0].name).size
  authSecretName: ".prepare.dependencies.secrets[0].name"
  name: .standup[0].parameters.model[0].name
routing:
  servicePort: .standup[0].parameters.ports.service
  parentRefs:
    - group: gateway.networking.k8s.io
      kind: Gateway
      name: infra-.standup[0].release-inference-gateway
  proxy:
    image: ".images[]|select(.name==\"llm-d-routing-sidecar\").registry/.images[]|select(.name==\"llm-d-routing-sidecar\").repo/.images[]|select(.name==\"llm-d-routing-sidecar\").image:.images[]|select(.name==\"llm-d-routing-sidecar\").tag"
    secure: false
    connector: nixlv2
    debugLevel: 3
  inferencePool:
    create: False
    name: .standup[0].parameters.model[0].label
  httpRoute:
    create: True
    rules:
    - backendRefs:
      - group: inference.networking.x-k8s.io
        kind: InferencePool
        name: .standup[0].parameters.model[0].label
        port: .standup[0].parameters.ports.service
        weight: 1
      timeouts:
        backendRequest: 0s
        request: 0s
      matches:
      - path:
          type: PathPrefix
          value: /.standup[0].parameters.model[0].name/
      filters:
      - type: URLRewrite
        urlRewrite:
          path:
            type: ReplacePrefixMatch
            replacePrefixMatch: /
    - backendRefs:
      - group: inference.networking.x-k8s.io
        kind: InferencePool
        name: .standup[0].parameters.model[0].label
        port: .standup[0].parameters.ports.service
        weight: 1
      timeouts:
        backendRequest: 0s
        request: 0s
  epp:
    create: False
decode:
  create: bool(.standup[0].parameters.replicas.decode)
  replicas: .standup[0].parameters.replicas.decode
  acceleratorTypes:
    labelKey: .standup[0].parameters.accelerators.decode.key
    labelValues:
      - .standup[0].parameters.accelerators.decode.value
  parallelism:
    data: .standup[0].parameters.parallelism.decode.data
    tensor: .standup[0].parameters.parallelism.decode.tensor
  annotations: .standup[0].parameters.annotations
  podAnnotations: .standup[0].parameters.annotations
  extraConfig:
  containers:
  - name: "vllm"
    mountModelVolume: true
    image: ".images[]|select(.name==\"llm-d\").registry/.images[]|select(.name==\"llm-d\").repo/.images[]|select(.name==\"llm-d\").image:.images[]|select(.name==\"llm-d\").tag"
    modelCommand: .standup[0].parameters.command.decode.type
    args: .standup[0].parameters.command.decode.args
    env: .standup[0].parameters.env.decode
    resources:
      limits: .standup[0].parameters.resources.decode
      requests: .standup[0].parameters.resources.decode
    extraConfig:
      startupProbe:
        httpGet:
          path: /health
          port: .standup[0].parameters.ports.service
        failureThreshold: 60
        initialDelaySeconds: 30
        periodSeconds: 30
        timeoutSeconds: 5
      livenessProbe:
        tcpSocket:
          port: .standup[0].parameters.ports.service
        failureThreshold: 3
        periodSeconds: 5
      readinessProbe:
        httpGet:
          path: /health
          port: .standup[0].parameters.ports.readiness
        failureThreshold: 3
        periodSeconds: 5
    volumeMounts:
  volumes:
prefill:
  create: bool(.standup[0].parameters.replicas.prefill)
  replicas: .standup[0].parameters.replicas.prefill]
  acceleratorTypes:
    labelKey: .standup[0].parameters.accelerators.prefill.key
    labelValues:
      - .standup[0].parameters.accelerators.prefill.value
  parallelism:
    data: .standup[0].parameters.parallelism.prefill.data
    tensor: .standup[0].parameters.parallelism.prefill.tensor
  annotations: .standup[0].parameters.annotations
  podAnnotations: .standup[0].parameters.annotations
  extraConfig:
  containers:
  - name: "vllm"
    mountModelVolume: true
    image: ".images[]|select(.name==\"llm-d\").registry/.images[]|select(.name==\"llm-d\").repo/.images[]|select(.name==\"llm-d\").image:.images[]|select(.name==\"llm-d\").tag"
    modelCommand: .standup[0].parameters.command.prefill.type
    args: .standup[0].parameters.command.prefill.args
    env: .standup[0].parameters.env.prefill
    resources:
      limits: .standup[0].parameters.resources.prefill
      requests: .standup[0].parameters.resources.prefill
    extraConfig:
      startupProbe:
        httpGet:
          path: /health
          port: .standup[0].parameters.ports.service
        failureThreshold: 60
        initialDelaySeconds: 30
        periodSeconds: 30
        timeoutSeconds: 5
      livenessProbe:
        tcpSocket:
          port: .standup[0].parameters.ports.service
        failureThreshold: 3
        periodSeconds: 5
      readinessProbe:
        httpGet:
          path: /health
          port: .standup[0].parameters.ports.service
        failureThreshold: 3
        periodSeconds: 5
    volumeMounts:
      - name: .harness[0].parameters.volumes[1].name
        mountPath: .harness[0].parameters.volumes[1].mount
  volumes:
      - name: .harness[0].parameters.volumes[1].name
        emptyDir:
          medium: .harness[0].parameters.volumes[1].type
          sizeLimit: .harness[0].parameters.volumes[1].size